name: CI

on:
  push:
    branches: 
      - master

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: do all
      env:
        TARBALL_ROOT: /opt/tars
      run: |
        mkdir -p "$TARBALL_ROOT"
        wget -O '/tmp/am-toolchains.zip' 'https://github.com/RMerl/am-toolchains/archive/master.zip'
        wget -O '/tmp/asuswrt-merlin.zip' 'https://github.com/RMerl/asuswrt-merlin/archive/master.zip'
        pushd /tmp
        unzip am-toolchains.zip
        unzip asuswrt-merlin.zip
        pushd am-toolchains-master/brcm-arm-hnd
        ls | grep crosstools | while read dir; do { tar cf - "$dir" | zstd - -o "${TARBALL_ROOT}/${dir}.tar.zst" } done
        popd
        pushd am-toolchains-master/brcm-arm-sdk
        ls | grep hndtools | while read dir; do { tar cf - "$dir" | zstd - -o "${TARBALL_ROOT}/${dir}.tar.zst" } done
        popd
        pushd asuswrt-merlin-master/tools/brcm/K26
        ls | grep hndtools | while read dir; do { tar cf - "$dir" | zstd - -o "${TARBALL_ROOT}/${dir}.tar.zst" } done
        popd
